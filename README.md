# AI Underwriter - Demo
This project serves to demonstrate the possibility of partial automation of the loan approval process for a merchant cash advance (MCA). The ulitmate purpose of this project was to explore the effectiveness of various machine learning models on loan underwriting. The project shows that with a few basic machine learning models, one can generate a machine that can decide whether to approve or deny a loan request with a high level of accuracy and produce reasonable offers for approved requests. Even with a small dataset, one can build a machine that extracts patterns used by a human underwriter and use them to generate offers.

The animation below shows an example of the final model generating an offer based on user provided inputs. Run `main.py` to see it in action.

<p align="center"><img width="504" height="840" src="https://thephilosophersdomain.files.wordpress.com/2019/05/aiunderwriterexample.gif?w=1000"></p>

## Model Performance
The approval prediction model uploaded here approves/denies MCA applications with an 87-89% accuracy. 

The payment prediction model generates a daily payment plan with 21.33% variation.

<p align="center"><img width="800" height="398" src="https://github.com/salman-a-shah/MCA-Underwriter/blob/master/figures/payment-prediction-fig.png"></p>

The term prediction model generates a term length between 60 to 90 business days with 11.28% variation.

<p align="center"><img width="800" height="398" src="https://github.com/salman-a-shah/MCA-Underwriter/blob/master/figures/term-prediction-fig.png"></p>

## Dataset
The dataset used for this project was synthetically generated with random number generators and, therefore, no values in the dataset correspond any real life business. However, the dataset generator was designed based on an underwriter's experience to resemble real life data as closely as possible. The current models were trained with a dataset containing 500 rows. The dataset has the potential to be expanded by running `data_generator.py` and labeling the randomly generated trials by hand. The new dataset can then be processed by running `data_cleaning.py` and the models can be updated by running `final_model_trainers.py` and `model_exporter.py`.

Here is an example produced by the random data generator:

<p align="center"><img width="377" height="406" src="https://github.com/salman-a-shah/MCA-Underwriter/blob/master/figures/data-generator.png"></p>

## Content Description
### main.py
This main script allows a user to input a new datapoint through the use of functions defined in `underwriter.py`.
### underwriter.py
Includes the following three functions:
#### new_user_input : function
Prompts the user to answer a series of questions and creates a datapoint using the inputs.
```
Parameter: None
Return: datapoint : (1,39) array
```
#### make_offer : function
Uses trained models to generate an offer, where the offer specifications include the following: 
- status:  approved or denied
- offer:   dollar amount offered. Defined by (payment * term)/rate
- rate:    interest rate. Fixed at 1.45
- term:    payback term in # of days
- payment: the daily payment
```
Parameter: datapoint : (1,39) array
Return: list[status, offer, rate, term, payment]
```
#### offer_tostring : function
Formats the list returned in `make_offer()` and returns the content as a string
```
Parameter: list[status, offer, rate, term, payment]
Return: string
```
### model_exporter.py
Trains and exports all three models as joblib packages using functions from `final_model_trainers.py`.
### final_model_trainers.py
Defines three functions--one for each model--that trains and returns their respective model.
#### approval_prediction_trainer : function
Fits and returns a classifier that makes loan approval predictions using boosted random forest.
```
Parameter: location of the dataset : string
Return: classifier : function
```
#### payment_prediction_trainer : function
Fits and returns a linear regression model that predicts the daily payment to be charged.
```
Parameter: location of the dataset : string
Return: regressor : function
```
#### term_prediction_trainer : function
Fits and returns a random forest regression model that predicts the loan term.
```
Parameter: location of the dataset : string
Return: regressor : function
```
### data_generator.py
A script for generating synthetic datapoints using random number generators.
### data_cleaning.py
Formats the dataset generated by `data_generator.py` to prepare for use in model training, including applying one hot encoding to business types and separating the lender payments into their own columns. Maximum number of lenders allowed is set to be 7.
### \*\_analysis.py
Scripts for exploring algorithms and evaluating performance for the respective models.
### data\\
#### dataset.csv
Data generated from `data_generator.py` are stored here.
#### dataset_cleaned.csv
Data cleaned using `data_cleaning.py`. Used in model training.
#### dataset_raw.csv
Basically a copy of dataset.csv. This exists to preserve an original copy of dataset.csv in case more data is added.
#### industry_list.csv
A list of business types, along with the mean and std for the Gaussians used to generate realistic values for the number of deposits in `data_generator.py`.
## Additional info
The full blog post on this model is available [here](https://thephilosophersdomain.com/portfolio/ai-underwriter/).

## Language
Coded entirely using python 3.7.2.
